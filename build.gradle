import java.util.regex.Pattern

buildscript {
	repositories {
		mavenLocal()
		mavenCentral()
		maven {
			url 'https://s01.oss.sonatype.org/content/repositories/snapshots/'
		}
	}
}

// [ GRADLE PLUGINS ]
plugins {
	id 'application'
	id 'org.springframework.boot' version "${springBootVersion}"
	id 'io.spring.dependency-management' version '1.0.11.RELEASE'
	id 'groovy'
	id 'java'

	// added to add CLI
	id "com.cognifide.common" version "1.1.15"
}

description = "Java Demo Application for spring-boot-starter-beapi"

// [ APPLYING GRADLE PLUGINS ]
apply plugin: 'application'

sourceCompatibility = "${sourceCompatibility}"

repositories {
	mavenLocal()
	mavenCentral()
	maven {
		url 'https://s01.oss.sonatype.org/content/repositories/snapshots/'
	}
}

apply plugin: "io.spring.dependency-management"

dependencies {
	// [LOCAL]
	//implementation 'io.beapi:spring-boot-starter-beapi:0.7.0-SNAPSHOT'
	implementation 'io.beapi:spring-boot-starter-beapi:0.6.0-STABLE

	// [CORE LIBS RATHER THAN STARTERS TO REDUCE JAR SIZE]
	implementation("jakarta.annotation:jakarta.annotation-api:1.3.5")
	implementation("jakarta.persistence:jakarta.persistence-api:2.2.3")
	implementation("jakarta.validation:jakarta.validation-api:2.0.2")
	implementation("org.apache.tomcat.embed:tomcat-embed-core:9.0.56")
	implementation("org.slf4j:slf4j-api:1.7.32")
	implementation("org.springframework.boot:spring-boot-autoconfigure:2.6.2")
	implementation("org.springframework.boot:spring-boot:2.6.2")
	implementation("org.springframework.data:spring-data-jpa:2.6.0")
	implementation("org.springframework.security:spring-security-config:5.6.1")
	implementation("org.springframework.security:spring-security-core:5.6.1")
	implementation("org.springframework.security:spring-security-crypto:5.6.1")
	implementation("org.springframework.security:spring-security-web:5.6.1")
	implementation("org.springframework:spring-beans:5.3.14")
	implementation("org.springframework:spring-context:5.3.14")
	implementation("org.springframework:spring-core:5.3.14")
	implementation("org.springframework:spring-jcl:5.3.14")
	implementation("org.springframework:spring-orm:5.3.14")
	implementation("org.springframework:spring-tx:5.3.14")
	implementation("org.springframework:spring-web:5.3.14")


	// [LOGGING]
	runtimeOnly 'org.slf4j:slf4j-api:1.7.15'

	// [TOKENS]
	implementation 'io.jsonwebtoken:jjwt:0.9.1'

	// [DATABASE]
	implementation('org.springframework.boot:spring-boot-starter-data-jpa')
	implementation 'com.zaxxer:HikariCP:3.2.0'
	runtimeOnly 'mysql:mysql-connector-java'

	// [TEST]
	implementation 'commons-io:commons-io:2.8.0'
	implementation 'org.codehaus.groovy:groovy'
	implementation 'org.codehaus.groovy:groovy-json:2.5.4'
	testImplementation('org.spockframework:spock-core:2.0-M3-groovy-3.0')
	testImplementation('org.spockframework:spock-spring:2.0-M3-groovy-3.0')
	testImplementation('org.springframework.boot:spring-boot-starter-test') {
		exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
	}
	testImplementation "org.springframework.boot:spring-boot-starter-test:${springBootVersion}"
	implementation 'org.apache.httpcomponents:httpclient:4.5.13'
}

ext.javaMainClass = "demo.application.Application"

application {
	mainClass = javaMainClass
	//applicationDefaultJvmArgs = ["-Xms1024m -Xmx2048m -XX:+UseParallelGC  -XX:ParallelGCThreads=4 -XX:MaxGCPauseMillis=300 -XX:MaxGCMinorPauseMillis=50 -server -noverify  -Xshare:off  -Djava.net.preferIPv4Stack=true -XX:+EliminateLocks -XX:GCTimeRatio=7 -Djava.security.egd=file:/dev/urandom"]
	//applicationDefaultJvmArgs = ["-Xms1024m -Xmx2048m -XX:+UseParallelGC  -XX:ParallelGCThreads=4 -XX:MaxGCPauseMillis=200 -XX:MaxGCMinorPauseMillis=75 -server -noverify  -Xshare:off  -Djava.net.preferIPv4Stack=true -XX:+EliminateLocks -XX:GCTimeRatio=7 -Djava.security.egd=file:/dev/urandom -Djdk.map.althashing.threshold=512"]
	// aws micro
	applicationDefaultJvmArgs = ["-Xms512m -Xmx1024m -XX:+UseParallelGC  -XX:ParallelGCThreads=4 -XX:MaxGCPauseMillis=200 -XX:MaxGCMinorPauseMillis=75 -server -noverify  -Xshare:off  -Djava.net.preferIPv4Stack=true -XX:+EliminateLocks -XX:GCTimeRatio=7 -Djava.security.egd=file:/dev/urandom -Djdk.map.althashing.threshold=512"]
}

springBoot {
	buildInfo()
}

test {
	useJUnitPlatform()
}

configurations {
	commonWebResources
}

jar {
	manifest {
		attributes 'Main-Class': javaMainClass
	}
}







